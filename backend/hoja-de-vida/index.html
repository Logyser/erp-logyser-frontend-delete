<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro Hoja de Vida - Logyser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --primary: #000b59;
      --primary-light: #1c2a80;
      --accent: #f55400;
      --bg: #f5f7fb;
      --bg-soft: #f0f2fb;
      --text: #222;
      --muted: #6b6b6b;
      --border: #d0d4e0;
      --error: #c0392b;
      --radius: 12px;
      --radius-lg: 18px;
      --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 12px;
    }

    .card {
      background: #fff;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 20px 18px 90px;
    }

    @media (min-width: 720px) {
      .card {
        padding: 24px 26px 26px;
      }
    }

    h1 {
      margin-top: 0;
      color: var(--primary);
      font-size: 1.6rem;
    }

    .subtitle {
      margin-top: 4px;
      margin-bottom: 16px;
      color: var(--muted);
      font-size: 0.95rem;
    }

    /* HEADER */
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 4px;
    }

    .header img {
      height: 44px;
      width: auto;
    }

    @media (max-width: 720px) {
      .page {
        padding: 0;
      }
      .card {
        border-radius: 0;
        min-height: 100vh;
      }

      .header {
        gap: 10px;
      }

      h1 {
        font-size: 1.4rem;
      }

      .subtitle {
        font-size: 0.85rem;
      }
    }

    /* STEPPER */
    .stepper {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      position: relative;
      padding: 0 2px;
    }

    .stepper::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 32px;
      right: 32px;
      height: 2px;
      background: #e0e3ee;
      transform: translateY(-50%);
      z-index: 0;
    }

    .step {
      position: relative;
      z-index: 1;
      flex: 1;
      text-align: center;
      font-size: 0.7rem;
      color: #9aa0b8;
    }

    .step-number {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      margin: 0 auto 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #e0e3ee;
      color: #555;
      font-weight: 600;
      font-size: 0.8rem;
    }

    .step-label {
      max-width: 110px;
      margin: 0 auto;
      line-height: 1.2;
    }

    .step.active .step-number {
      background: var(--primary);
      color: #fff;
    }

    .step.completed .step-number {
      background: var(--accent);
      color: #fff;
    }

    .step.active {
      color: var(--primary);
      font-weight: 600;
    }

    @media (max-width: 720px) {
      .stepper {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 4px;
        scrollbar-width: thin;
      }

      .stepper::before {
        display: none;
      }

      .step {
        display: inline-block;
        min-width: 80px;
      }
    }

    /* FORM */
    form {
      margin-top: 4px;
    }

    .form-step {
      display: none;
    }

    .form-step.active {
      display: block;
      animation: fadeIn 0.25s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .step-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--primary);
      font-size: 1.05rem;
    }

    .help-text {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px 18px;
    }

    @media (max-width: 720px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #444;
    }

    .field span.required {
      color: var(--accent);
      margin-left: 3px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      padding: 10px 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease,
        background 0.16s ease;
      background: #fdfdff;
      width: 100%;
      resize: vertical;
      min-height: 42px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 11, 89, 0.18);
      background: #fff;
    }

    textarea {
      min-height: 70px;
      font-size: 0.9rem;
    }

    .field-small {
      max-width: 180px;
    }

    .error-message {
      margin-top: 8px;
      color: var(--error);
      font-size: 0.8rem;
    }

    .hidden {
      display: none !important;
    }

    /* BOTONES */
    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      padding: 9px 18px;
      border: none;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, transform 0.05s ease,
        box-shadow 0.15s ease, opacity 0.15s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 4px 14px rgba(0, 11, 89, 0.3);
    }

    .btn-primary:hover {
      background: var(--primary-light);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #eef0fb;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e3f7;
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    @media (max-width: 720px) {
      .buttons {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.98);
        padding: 10px 14px;
        border-top: 1px solid #ddd;
        z-index: 999;
      }
      .card {
        padding-bottom: 90px;
      }
      .btn-primary {
        padding: 11px 22px;
        border-radius: 12px;
        font-size: 1rem;
      }
    }

    /* CARDS DIN√ÅMICAS (Educaci√≥n / Exp / Familia) */
    .educ-card,
    .exp-card,
    .fam-card {
      border-radius: 14px;
      padding: 14px 16px;
      margin-top: 12px;
      border: 1px solid #d9dbe8;
    }

    .educ-card {
      background: #f6f7ff;
      border-color: #d1d5ff;
    }

    .exp-card {
      background: #fff7f0;
      border-color: #ffd8b3;
    }

    .fam-card {
      background: #eef7ff;
      border-color: #bcd9ff;
    }

    .educ-grid,
    .exp-grid,
    .fam-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px 16px;
    }

    @media (max-width: 720px) {
      .educ-grid,
      .exp-grid,
      .fam-grid {
        grid-template-columns: 1fr;
      }
    }

    .educ-remove,
    .exp-remove,
    .fam-remove {
      background: #ffe6e6;
      border: 1px solid #ffbdbd;
      color: #a30000;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      cursor: pointer;
      margin-top: 8px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* REFERENCIAS CARDS */
    .ref-card {
      background: #fdfcff;
      border-radius: 14px;
      border: 1px solid #dde1f0;
      padding: 12px 14px;
      margin-top: 14px;
    }

    .ref-card h4 {
      margin: 0 0 8px;
      font-size: 0.95rem;
      color: var(--primary);
    }

    /* PREVIEW */
    .preview-container {
      margin-top: 8px;
      border-radius: 14px;
      background: var(--bg-soft);
      padding: 10px 10px 4px;
      border: 1px solid #dde0f0;
      max-height: 55vh;
      overflow-y: auto;
    }

    .preview-section {
      margin-bottom: 8px;
    }

    .preview-section details {
      border-radius: 12px;
      background: #fff;
      border: 1px solid #e1e4f5;
      padding: 8px 10px;
    }

    .preview-section summary {
      list-style: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .preview-section summary::-webkit-details-marker {
      display: none;
    }

    .preview-pill {
      display: inline-flex;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f3f4ff;
      font-size: 0.7rem;
      color: var(--muted);
      margin-left: 8px;
    }

    .preview-content {
      margin-top: 6px;
      font-size: 0.86rem;
      color: #333;
    }

    .preview-row {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 0.82rem;
    }

    .preview-label {
      font-weight: 600;
      color: #555;
    }

    .preview-value {
      text-align: right;
      color: #222;
    }

    @media (max-width: 720px) {
      .preview-row {
        flex-direction: column;
        text-align: left;
      }

      .preview-value {
        text-align: left;
      }
    }
    .field-help {
      font-size: 0.85rem;
      color: #555;
      margin-top: -5px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <div class="header">
        <img src="https://storage.googleapis.com/encuesta_satisfaccion/logo.png"
             alt="Logo Logyser" />
        <div>
          <h1>Registro de Hoja de Vida</h1>
          <p class="subtitle">
            Diligencia tu informaci√≥n en pocos pasos. Si ya te has registrado antes,
            podr√°s actualizar tus datos con tu n√∫mero de identificaci√≥n.
          </p>
        </div>
      </div>

      <!-- STEPPER -->
      <div class="stepper" id="stepper">
        <div class="step active" data-step="0">
          <div class="step-number">1</div>
          <div class="step-label">Ingreso</div>
        </div>

        <div class="step" data-step="1">
          <div class="step-number">2</div>
          <div class="step-label">Medio de reclutamiento</div>
        </div>

        <div class="step" data-step="2">
          <div class="step-number">3</div>
          <div class="step-label">Datos personales</div>
        </div>

        <div class="step" data-step="3">
          <div class="step-number">4</div>
          <div class="step-label">Educaci√≥n</div>
        </div>

        <div class="step" data-step="4">
          <div class="step-number">5</div>
          <div class="step-label">Experiencia</div>
        </div>

        <div class="step" data-step="5">
          <div class="step-number">6</div>
          <div class="step-label">Familia / Referencias</div>
        </div>

        <div class="step" data-step="6">
          <div class="step-number">7</div>
          <div class="step-label">Emergencia / Metas</div>
        </div>

        <div class="step" data-step="7">
          <div class="step-number">8</div>
          <div class="step-label">Cuestionario</div>
        </div>

        <div class="step" data-step="8">
          <div class="step-number">9</div>
          <div class="step-label">Revisi√≥n</div>
        </div>
      </div>

      <!-- FORM -->
      <form id="hv-form">
        <!-- PASO 0: INGRESO -->
        <div class="form-step active" data-step="0">
          <div class="step-title">Ingreso al formulario</div>
          <p class="help-text">
            Ingresa tu tipo y n√∫mero de identificaci√≥n. Si ya tienes informaci√≥n registrada,
            la cargaremos autom√°ticamente para que solo actualices lo que haga falta.
          </p>

          <div class="grid">
            <div class="field">
              <label for="tipo_documento_ingreso">
                Tipo de identificaci√≥n <span class="required">*</span>
              </label>
              <select id="tipo_documento_ingreso" data-required="true">
              <option value="">Selecciona...</option>
            </select>
            </div>

            <div class="field">
              <label for="identificacion_ingreso">
                N√∫mero de identificaci√≥n <span class="required">*</span>
              </label>
              <input type="text" id="identificacion_ingreso" data-required="true" />
            </div>
          </div>

          <div id="ingreso-msg" class="error-message" style="margin-top:10px;"></div>
        </div>

        <!-- PASO 1: MEDIO DE RECLUTAMIENTO -->
        <div class="form-step" data-step="1">
          <div class="step-title">Paso 1: ¬øC√≥mo llegaste a la oferta?</div>
          <div class="grid">
            <div class="field">
              <label for="medio_reclutamiento">
                Medio de reclutamiento <span class="required">*</span>
              </label>
              <select
                id="medio_reclutamiento"
                name="medio_reclutamiento"
                data-required="true"
              >
                <option value="">Selecciona una opci√≥n</option>
                <option value="pagina_web">P√°gina web Logyser</option>
                <option value="plataforma_empleo">Plataforma de empleo</option>
                <option value="redes_sociales">Redes sociales</option>
                <option value="recomendado">Recomendado</option>
                <option value="empleado_interno">Empleado interno</option>
                <option value="agencia">Agencia de empleo</option>
                <option value="otro">Otro</option>
              </select>
              <div class="help-text">
                Esta informaci√≥n nos ayuda a mejorar nuestros canales de reclutamiento.
              </div>
            </div>

            <div class="field hidden" id="campo-recomendador">
              <label for="recomendador_aspirante">
                ¬øQui√©n te recomend√≥? / Nombre del contacto
              </label>
              <input
                type="text"
                id="recomendador_aspirante"
                name="recomendador_aspirante"
                placeholder="Nombre de la persona o entidad"
              />
            </div>
          </div>
          <div id="error-step-1" class="error-message"></div>
        </div>

        <!-- PASO 2: DATOS PERSONALES -->
        <div class="form-step" data-step="2">
          <div class="step-title">Paso 2: Datos personales</div>
          <div class="grid">
            <div class="field">
              <label for="tipo_documento">
                Tipo de identificaci√≥n <span class="required">*</span>
              </label>
              <select
              id="tipo_documento"
              name="tipo_documento"
              data-required="true"
            >
              <option value="">Selecciona...</option>
            </select>

            </div>

            <div class="field">
              <label for="identificacion">
                N√∫mero de identificaci√≥n <span class="required">*</span>
              </label>
              <input
                type="text"
                id="identificacion"
                name="identificacion"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="primer_nombre">
                Primer nombre <span class="required">*</span>
              </label>
              <input
                type="text"
                id="primer_nombre"
                name="primer_nombre"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="segundo_nombre">Segundo nombre</label>
              <input
                type="text"
                id="segundo_nombre"
                name="segundo_nombre"
              />
            </div>

            <div class="field">
              <label for="primer_apellido">
                Primer apellido <span class="required">*</span>
              </label>
              <input
                type="text"
                id="primer_apellido"
                name="primer_apellido"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="segundo_apellido">Segundo apellido</label>
              <input
                type="text"
                id="segundo_apellido"
                name="segundo_apellido"
              />
            </div>

            <div class="field">
              <label for="fecha_nacimiento">
                Fecha de nacimiento <span class="required">*</span>
              </label>
              <input
                type="date"
                id="fecha_nacimiento"
                name="fecha_nacimiento"
                data-required="true"
              />
            </div>

            <div class="field field-small">
              <label for="edad">Edad</label>
              <input
                type="number"
                id="edad"
                name="edad"
                readonly
              />
              <div class="help-text">
                Se calcula autom√°ticamente a partir de tu fecha de nacimiento.
              </div>
            </div>

            <div class="field">
              <label for="departamento_expedicion">
                Departamento de expedici√≥n <span class="required">*</span>
              </label>
              <p class="field-help">Si se expidi√≥ en Bogot√°, escoge D.C</p>
              <select id="departamento_expedicion" data-required="true"></select>
            </div>

            <div class="field">
              <label for="ciudad_expedicion">
                Ciudad de expedici√≥n <span class="required">*</span>
              </label>

              <p class="field-help">&nbsp;</p>

              <select id="ciudad_expedicion" data-required="true"></select>
            </div>

            <div class="field">
              <label for="fecha_expedicion">
                Fecha de expedici√≥n <span class="required">*</span>
              </label>
              <input
                type="date"
                id="fecha_expedicion"
                name="fecha_expedicion"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="estado_civil">
                Estado civil <span class="required">*</span>
              </label>
              <select
                id="estado_civil"
                name="estado_civil"
                data-required="true"
              >
                <option value="">Selecciona una opci√≥n</option>
                <option value="soltero">Soltero(a)</option>
                <option value="casado">Casado(a)</option>
                <option value="union_libre">Uni√≥n libre</option>
                <option value="divorciado">Divorciado(a)</option>
                <option value="viudo">Viudo(a)</option>
              </select>
            </div>

            <div class="field">
              <label for="direccion_barrio">
                Direcci√≥n y barrio <span class="required">*</span>
              </label>
              <input
                type="text"
                id="direccion_barrio"
                name="direccion_barrio"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="departamento_residencia">
                Departamento de residencia <span class="required">*</span>
              </label>
              <select id="departamento_residencia" data-required="true"></select>
            </div>

            <div class="field">
              <label for="ciudad_residencia">
                Ciudad de residencia <span class="required">*</span>
              </label>
              <select id="ciudad_residencia" data-required="true"></select>
            </div>

            <div class="field">
              <label for="telefono">
                Tel√©fono / Celular <span class="required">*</span>
              </label>
              <input
                type="tel"
                id="telefono"
                name="telefono"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="correo_electronico">
                Correo electr√≥nico <span class="required">*</span>
              </label>
              <input
                type="email"
                id="correo_electronico"
                name="correo_electronico"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="eps">
                EPS <span class="required">*</span>
              </label>
              <select id="eps" data-required="true"></select>
            </div>

            <div class="field">
              <label for="afp">
                Fondo de pensi√≥n <span class="required">*</span>
              </label>
              <select id="afp" data-required="true"></select>
            </div>

            <div class="field">
              <label for="rh">
                Grupo sangu√≠neo (RH) <span class="required">*</span>
              </label>
              <select id="rh" name="rh" data-required="true">
                <option value="">Selecciona una opci√≥n</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>

            <div class="field">
              <label for="talla_pantalon">
                Talla pantal√≥n <span class="required">*</span>
              </label>
              <input
                type="text"
                id="talla_pantalon"
                name="talla_pantalon"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="camisa_talla">
                Talla camisa <span class="required">*</span>
              </label>
              <input
                type="text"
                id="camisa_talla"
                name="camisa_talla"
                data-required="true"
              />
            </div>

            <div class="field">
              <label for="zapatos_talla">
                Talla zapatos <span class="required">*</span>
              </label>
              <input
                type="text"
                id="zapatos_talla"
                name="zapatos_talla"
                data-required="true"
              />
            </div>
          </div>
          <div id="error-step-2" class="error-message"></div>
        </div>

        <!-- PASO 3: EDUCACI√ìN -->
        <div class="form-step" data-step="3">
          <div class="step-title">Paso 3: Educaci√≥n</div>
          <p class="help-text">
            Registra tus estudios realizados. Puedes agregar todos los que necesites.
          </p>

          <div id="educacion-list"></div>

          <button type="button" class="btn btn-primary" id="btn-add-educacion" style="margin-top: 10px;">
            ‚ûï Agregar estudio
          </button>

          <div id="error-step-3" class="error-message"></div>
        </div>

        <!-- PASO 4: EXPERIENCIA -->
        <div class="form-step" data-step="4">
          <div class="step-title">Paso 4: Experiencia laboral</div>
          <p class="help-text">
            Registra tus empleos anteriores. Puedes agregar tantos como necesites.
          </p>

          <div id="exp-list"></div>

          <button type="button" class="btn btn-primary" id="btn-add-exp" style="margin-top: 10px;">
            ‚ûï Agregar experiencia laboral
          </button>

          <div id="error-step-4" class="error-message"></div>
        </div>

        <!-- PASO 5: FAMILIA + REFERENCIAS -->
        <div class="form-step" data-step="5">
          <div class="step-title">Paso 5: Familiares y referencias</div>

          <p class="help-text">
            Registra tu n√∫cleo familiar y las referencias que podamos contactar.
          </p>

          <!-- Familiares -->
          <div id="fam-list"></div>

          <button type="button" class="btn btn-primary" id="btn-add-fam" style="margin-top: 10px;">
            ‚ûï Agregar familiar
          </button>

          <div id="error-step-5" class="error-message" style="margin-top: 10px;"></div>

          <!-- Referencias -->
          <div style="margin-top: 28px;">
            <div class="step-title">Referencias</div>

            <div class="ref-card">
              <h4>Referencia laboral</h4>
              <div class="grid">
                <div class="field">
                  <label>Empresa</label>
                  <input type="text" id="ref_lab_empresa" />
                </div>
                <div class="field">
                  <label>Jefe inmediato</label>
                  <input type="text" id="ref_lab_jefe" />
                </div>
                <div class="field">
                  <label>Cargo</label>
                  <input type="text" id="ref_lab_cargo" />
                </div>
                <div class="field">
                  <label>Tel√©fono</label>
                  <input type="text" id="ref_lab_tel" />
                </div>
              </div>
            </div>

            <div class="ref-card">
              <h4>Referencia familiar</h4>
              <div class="grid">
                <div class="field">
                  <label>Nombre</label>
                  <input type="text" id="ref_fam_nombre" />
                </div>
                <div class="field">
                  <label>Parentesco</label>
                  <input type="text" id="ref_fam_parentesco" />
                </div>
                <div class="field">
                  <label>Tel√©fono</label>
                  <input type="text" id="ref_fam_tel" />
                </div>
                <div class="field">
                  <label>Ocupaci√≥n</label>
                  <input type="text" id="ref_fam_ocupacion" />
                </div>
              </div>
            </div>

            <div class="ref-card">
              <h4>Referencia personal</h4>
              <div class="grid">
                <div class="field">
                  <label>Nombre</label>
                  <input type="text" id="ref_per_nombre" />
                </div>
                <div class="field">
                  <label>Relaci√≥n</label>
                  <input type="text" id="ref_per_relacion" />
                </div>
                <div class="field">
                  <label>Tel√©fono</label>
                  <input type="text" id="ref_per_tel" />
                </div>
                <div class="field">
                  <label>Ocupaci√≥n</label>
                  <input type="text" id="ref_per_ocupacion" />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- PASO 6: EMERGENCIA + METAS -->
        <div class="form-step" data-step="6">
          <div class="step-title">Paso 6: Contacto de emergencia y metas</div>

          <p class="help-text">
            Indica a qui√©n debemos contactar en caso de emergencia y cu√©ntanos tus metas.
          </p>

          <div class="grid">
            <div class="field">
              <label>Nombre completo (emergencia)</label>
              <input type="text" id="emer_nombre" />
            </div>

            <div class="field">
              <label>Parentesco</label>
              <input type="text" id="emer_parentesco" />
            </div>

            <div class="field">
              <label>Tel√©fono</label>
              <input type="tel" id="emer_telefono" />
            </div>

            <div class="field">
              <label>Correo electr√≥nico</label>
              <input type="email" id="emer_correo" />
            </div>

            <div class="field" style="grid-column:span 2;">
              <label>Direcci√≥n</label>
              <input type="text" id="emer_direccion" />
            </div>
          </div>

          <div style="margin-top: 20px;">
            <div class="step-title">Metas personales</div>

            <div class="field">
              <label>Corto plazo</label>
              <textarea id="meta_corto" rows="2"></textarea>
            </div>

            <div class="field">
              <label>Mediano plazo</label>
              <textarea id="meta_mediano" rows="2"></textarea>
            </div>

            <div class="field">
              <label>Largo plazo</label>
              <textarea id="meta_largo" rows="2"></textarea>
            </div>
          </div>
        </div>

        <!-- PASO 7: CUESTIONARIO PERSONAL -->
        <div class="form-step" data-step="7">
          <div class="step-title">Paso 7: Cuestionario personal y seguridad</div>
          <p class="help-text">
            Responde con sinceridad. Esta informaci√≥n es confidencial y se usa solo para el proceso.
          </p>

          <div class="grid">
            <div class="field">
              <label>¬øHas tenido llamados de atenci√≥n?</label>
              <select id="seg_llamados">
                <option value="0">No</option>
                <option value="1">S√≠</option>
              </select>
            </div>

            <div class="field hidden" id="detalle_llamados_wrap">
              <label>Describe los llamados de atenci√≥n</label>
              <textarea id="seg_detalle_llamados" rows="2"></textarea>
            </div>

            <div class="field">
              <label>¬øHas sufrido accidente laboral?</label>
              <select id="seg_accidente">
                <option value="0">No</option>
                <option value="1">S√≠</option>
              </select>
            </div>

            <div class="field hidden" id="detalle_accidente_wrap">
              <label>Describe el accidente o enfermedad laboral</label>
              <textarea id="seg_detalle_accidente" rows="2"></textarea>
            </div>

            <div class="field">
              <label>¬øTienes alguna enfermedad importante?</label>
              <select id="seg_enfermedad">
                <option value="0">No</option>
                <option value="1">S√≠</option>
              </select>
            </div>

            <div class="field hidden" id="detalle_enfermedad_wrap">
              <label>Describe la enfermedad</label>
              <textarea id="seg_detalle_enfermedad" rows="2"></textarea>
            </div>

            <div class="field">
              <label>¬øConsumes alcohol?</label>
              <select id="seg_alcohol">
                <option value="0">No</option>
                <option value="1">S√≠</option>
              </select>
            </div>

            <div class="field hidden" id="detalle_alcohol_wrap">
              <label>Frecuencia (si aplica)</label>
              <input type="text" id="seg_frecuencia" />
            </div>

            <div class="field">
              <label>¬øAlg√∫n familiar trabaja aqu√≠?</label>
              <select id="seg_familiar">
                <option value="0">No</option>
                <option value="1">S√≠</option>
              </select>
            </div>

            <div class="field hidden" id="detalle_familiar_wrap">
              <label>Nombre del familiar y relaci√≥n</label>
              <input type="text" id="seg_familiar_nombre" />
            </div>

            <div class="field">
              <label>¬øHas suministrado informaci√≥n falsa?</label>
              <select id="seg_falsa">
                <option value="0">No</option>
                <option value="1">S√≠</option>
              </select>
            </div>

            <div class="field">
              <label>¬øAceptas pruebas de validaci√≥n o pol√≠grafo de ser necesario?</label>
              <select id="seg_poligrafo">
                <option value="1">S√≠</option>
                <option value="0">No</option>
              </select>
            </div>
          </div>

          <div class="field" style="margin-top:14px;">
            <label>Observaciones adicionales</label>
            <textarea id="seg_observaciones" rows="2"></textarea>
          </div>

          <div class="field">
            <label>¬øPor qu√© crees que calificas para el cargo?</label>
            <textarea id="seg_califica" rows="2"></textarea>
          </div>

          <div class="field">
            <label>Fortalezas</label>
            <textarea id="seg_fortal" rows="2"></textarea>
          </div>

          <div class="field">
            <label>Aspectos por mejorar</label>
            <textarea id="seg_mejorar" rows="2"></textarea>
          </div>

          <div class="field">
            <label>Describe una situaci√≥n dif√≠cil que enfrentaste y c√≥mo la resolviste.</label>
            <textarea id="seg_resolucion" rows="2"></textarea>
          </div>
        </div>

        <!-- PASO 8: PREVISUALIZACI√ìN -->
        <div class="form-step" data-step="8">
          <div class="step-title">Paso 8: Revisi√≥n y env√≠o</div>
          <p class="help-text">
            Verifica un resumen de la informaci√≥n que registraste. Puedes volver a pasos anteriores si quieres corregir algo
            antes de enviar.
          </p>

          <div id="preview-container" class="preview-container"></div>
        </div>

        <!-- BOTONES -->
        <div class="buttons">
          <button
            type="button"
            class="btn btn-secondary"
            id="btn-prev"
            disabled
          >
            ‚¨Ö Anterior
          </button>
          <div style="display:flex; gap:8px;">
            <button
              type="button"
              class="btn btn-primary"
              id="btn-next"
            >
              Siguiente ‚ûù
            </button>
            <button
              type="submit"
              class="btn btn-primary hidden"
              id="btn-submit"
            >
              Enviar hoja de vida ‚úÖ
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById("hv-form");
    const steps = Array.from(document.querySelectorAll(".form-step"));
    const stepperItems = Array.from(document.querySelectorAll(".stepper .step"));
    const btnPrev = document.getElementById("btn-prev");
    const btnNext = document.getElementById("btn-next");
    const btnSubmit = document.getElementById("btn-submit");
    const medioSelect = document.getElementById("medio_reclutamiento");
    const campoRecomendador = document.getElementById("campo-recomendador");
    const fechaNacimientoInput = document.getElementById("fecha_nacimiento");
    const edadInput = document.getElementById("edad");

    // Paso 0 (Ingreso)
    const identificacionIngreso = document.getElementById("identificacion_ingreso");
    const tipoDocumentoIngreso = document.getElementById("tipo_documento_ingreso");
    const medioReclutamiento = document.getElementById("medio_reclutamiento");
    const ingresoMsg = document.getElementById("ingreso-msg");

    // Referencias
    const ref_lab_empresa = document.getElementById("ref_lab_empresa");
    const ref_lab_jefe = document.getElementById("ref_lab_jefe");
    const ref_lab_cargo = document.getElementById("ref_lab_cargo");
    const ref_lab_tel = document.getElementById("ref_lab_tel");

    const ref_fam_nombre = document.getElementById("ref_fam_nombre");
    const ref_fam_parentesco = document.getElementById("ref_fam_parentesco");
    const ref_fam_tel = document.getElementById("ref_fam_tel");
    const ref_fam_ocupacion = document.getElementById("ref_fam_ocupacion");

    const ref_per_nombre = document.getElementById("ref_per_nombre");
    const ref_per_relacion = document.getElementById("ref_per_relacion");
    const ref_per_tel = document.getElementById("ref_per_tel");
    const ref_per_ocupacion = document.getElementById("ref_per_ocupacion");

    // Emergencia
    const emer_nombre = document.getElementById("emer_nombre");
    const emer_parentesco = document.getElementById("emer_parentesco");
    const emer_telefono = document.getElementById("emer_telefono");
    const emer_correo = document.getElementById("emer_correo");
    const emer_direccion = document.getElementById("emer_direccion");

    // Metas
    const meta_corto = document.getElementById("meta_corto");
    const meta_mediano = document.getElementById("meta_mediano");
    const meta_largo = document.getElementById("meta_largo");

    // Seguridad
    const seg_llamados = document.getElementById("seg_llamados");
    const seg_accidente = document.getElementById("seg_accidente");
    const seg_enfermedad = document.getElementById("seg_enfermedad");
    const seg_alcohol = document.getElementById("seg_alcohol");
    const seg_familiar = document.getElementById("seg_familiar");
    const seg_familiar_nombre = document.getElementById("seg_familiar_nombre");
    const seg_frecuencia = document.getElementById("seg_frecuencia");
    const seg_falsa = document.getElementById("seg_falsa");
    const seg_poligrafo = document.getElementById("seg_poligrafo");
    const seg_observaciones = document.getElementById("seg_observaciones");
    const seg_califica = document.getElementById("seg_califica");
    const seg_fortal = document.getElementById("seg_fortal");
    const seg_mejorar = document.getElementById("seg_mejorar");
    const seg_resolucion = document.getElementById("seg_resolucion");

    // Datos personales base
    const identificacionInput = document.getElementById("identificacion");

    let currentStep = 0;

    // ‚≠ê AHORA S√ç PONLO AQU√ç ‚≠ê
    showStep(0);

    // ========= PASO 0: Validaci√≥n de ingreso =========
    async function validarIngreso() {
  const tipo = tipoDocumentoIngreso.value.trim();
  const id = identificacionIngreso.value.trim();

  if (!tipo || !id) {
    ingresoMsg.textContent = "Debes completar ambos campos.";
    ingresoMsg.style.color = "var(--error)";
    return false;
  }

  try {
    const resp = await fetch(`/api/aspirante?identificacion=${id}`);
    const data = await resp.json();

    if (data.existe) {
      ingresoMsg.style.color = "green";
      ingresoMsg.textContent = "‚úî Registro encontrado. Cargando datos...";

      // <-- CAMBIO: pasar todo `data` para que `rellenarFormulario`
      // reciba `data.educacion`, `data.experiencia_laboral`, etc.
      rellenarFormulario(data);

      // Sincronizar identificaci√≥n y tipo de documento con el paso 2
      if (identificacionInput) identificacionInput.value = id;
      const tipoDocMain = document.getElementById("tipo_documento");
      if (tipoDocMain) tipoDocMain.value = tipo;

      setTimeout(() => {
        showStep(1);
      }, 300);

      return true;
    } else {
      ingresoMsg.style.color = "#444";
      ingresoMsg.textContent = "‚Ñπ No encontramos un registro previo. Contin√∫a con el formulario.";

      setTimeout(() => {
        showStep(1);
      }, 300);
      return true;
    }
  } catch (err) {
    ingresoMsg.style.color = "var(--error)";
    ingresoMsg.textContent = "‚ö† Error consultando el servidor.";
    console.error(err);
    return false;
  }
}

    identificacionIngreso.addEventListener("blur", validarIngreso);
    tipoDocumentoIngreso.addEventListener("change", () => {
      ingresoMsg.textContent = "";
    });

    function showStep(index) {
      steps.forEach((step, i) => {
        step.classList.toggle("active", i === index);
      });

      stepperItems.forEach((item, i) => {
        item.classList.remove("active", "completed");
        if (i === index) {
          item.classList.add("active");
        } else if (i < index) {
          item.classList.add("completed");
        }
      });

      btnPrev.disabled = index === 0;

      if (index === steps.length - 1) {
        btnNext.classList.add("hidden");
        btnSubmit.classList.remove("hidden");
      } else {
        btnNext.classList.remove("hidden");
        btnSubmit.classList.add("hidden");
      }

      currentStep = index;

      // Si entramos a la previsualizaci√≥n, construir resumen
      if (index === 8) {
        buildPreview();
      }
    }

    function validateStep(stepIndex) {
      const stepElement = steps[stepIndex];
      const requiredFields = stepElement.querySelectorAll("[data-required='true']");
      let valid = true;
      let firstInvalid = null;

      requiredFields.forEach((field) => {
        const value = (field.value || "").trim();
        const isInvalid = value === "";
        field.style.borderColor = isInvalid ? "var(--error)" : "var(--border)";
        if (isInvalid && !firstInvalid) {
          firstInvalid = field;
        }
        if (isInvalid) valid = false;
      });

      const errorDiv = document.getElementById(`error-step-${stepIndex}`);
      if (errorDiv) {
        if (!valid) {
          errorDiv.textContent =
            "Por favor completa los campos obligatorios marcados con * antes de continuar.";
        } else {
          errorDiv.textContent = "";
        }
      }

      if (firstInvalid) {
        firstInvalid.focus();
      }

      return valid;
    }

    // =====================
    // EDUCACI√ìN DIN√ÅMICA
    // =====================
    const educacionList = document.getElementById("educacion-list");
    const btnAddEducacion = document.getElementById("btn-add-educacion");

    let educacionData = [];

    function crearCardEducacion(index, data = {}) {
      return `
        <div class="educ-card" data-index="${index}">
          <div class="educ-grid">
            <div class="field">
              <label>Instituci√≥n</label>
              <input type="text" class="educ-institucion" value="${data.institucion || ""}">
            </div>
            <div class="field">
              <label>Programa</label>
              <input type="text" class="educ-programa" value="${data.programa || ""}">
            </div>
            <div class="field">
              <label>Modalidad</label>
              <select class="educ-modalidad">
                <option value="">Selecciona</option>
                <option value="presencial" ${data.modalidad === "presencial" ? "selected" : ""}>Presencial</option>
                <option value="virtual" ${data.modalidad === "virtual" ? "selected" : ""}>Virtual</option>
                <option value="distancia" ${data.modalidad === "distancia" ? "selected" : ""}>A distancia</option>
              </select>
            </div>
            <div class="field">
              <label>A√±o</label>
              <input type="number" class="educ-ano" min="1950" max="2050" value="${data.ano || ""}">
            </div>
            <div class="field">
              <label>Finalizado</label>
              <select class="educ-finalizado">
                <option value="1" ${data.finalizado == 1 ? "selected" : ""}>S√≠</option>
                <option value="0" ${data.finalizado == 0 ? "selected" : ""}>No</option>
              </select>
            </div>
          </div>
          <span class="educ-remove" onclick="eliminarEducacion(${index})">üóëÔ∏è Eliminar</span>
        </div>
      `;
    }

    function renderEducacion() {
      educacionList.innerHTML = "";
      educacionData.forEach((item, index) => {
        educacionList.innerHTML += crearCardEducacion(index, item);
      });
    }

    btnAddEducacion.addEventListener("click", () => {
      recopilarEducacion();
      educacionData.push({
        institucion: "",
        programa: "",
        modalidad: "",
        ano: "",
        finalizado: "1"
      });
      renderEducacion();
    });

    function eliminarEducacion(index) {
      educacionData.splice(index, 1);
      renderEducacion();
    }
    window.eliminarEducacion = eliminarEducacion;

    function recopilarEducacion() {
      const cards = document.querySelectorAll(".educ-card");

      educacionData = Array.from(cards).map(card => ({
        institucion: card.querySelector(".educ-institucion").value.trim(),
        programa: card.querySelector(".educ-programa").value.trim(),
        modalidad: card.querySelector(".educ-modalidad").value.trim(),
        ano: card.querySelector(".educ-ano").value.trim(),
        finalizado: card.querySelector(".educ-finalizado").value.trim()
      }));

      return educacionData;
    }

    // =====================
    // EXPERIENCIA LABORAL
    // =====================
    const expList = document.getElementById("exp-list");
    const btnAddExp = document.getElementById("btn-add-exp");

    let expData = [];

    function crearCardExp(index, data = {}) {
      return `
        <div class="exp-card" data-index="${index}">
          <div class="exp-grid">
            <div class="field">
              <label>Empresa</label>
              <input type="text" class="exp-empresa" value="${data.empresa || ""}">
            </div>
            <div class="field">
              <label>Cargo</label>
              <input type="text" class="exp-cargo" value="${data.cargo || ""}">
            </div>
            <div class="field">
              <label>Tiempo laborado</label>
              <input type="text" class="exp-tiempo" value="${data.tiempo_laborado || ""}">
            </div>
            <div class="field">
              <label>Salario</label>
              <input type="text" class="exp-salario" value="${data.salario || ""}">
            </div>
            <div class="field">
              <label>Motivo del retiro</label>
              <input type="text" class="exp-motivo" value="${data.motivo_retiro || ""}">
            </div>
            <div class="field">
              <label>Causa del motivo</label>
              <input type="text" class="exp-causa" value="${data.causa_motivo_retiro || ""}">
            </div>
            <div class="field" style="grid-column: span 2;">
              <label>Funciones realizadas</label>
              <textarea class="exp-funciones" rows="2">${data.funciones || ""}</textarea>
            </div>
            <div class="field" style="grid-column: span 2;">
              <label>Observaciones</label>
              <textarea class="exp-observaciones" rows="2">${data.observaciones || ""}</textarea>
            </div>
          </div>
          <span class="exp-remove" onclick="eliminarExp(${index})">üóëÔ∏è Eliminar</span>
        </div>
      `;
    }

    function renderExp() {
      expList.innerHTML = "";
      expData.forEach((item, index) => {
        expList.innerHTML += crearCardExp(index, item);
      });
    }

    btnAddExp.addEventListener("click", () => {
      recopilarExp();
      expData.push({
        empresa: "",
        cargo: "",
        tiempo_laborado: "",
        salario: "",
        motivo_retiro: "",
        causa_motivo_retiro: "",
        funciones: "",
        observaciones: ""
      });
      renderExp();
    });

    function eliminarExp(index) {
      expData.splice(index, 1);
      renderExp();
    }
    window.eliminarExp = eliminarExp;

    function recopilarExp() {
      const cards = document.querySelectorAll(".exp-card");

      expData = Array.from(cards).map(card => ({
        empresa: card.querySelector(".exp-empresa").value.trim(),
        cargo: card.querySelector(".exp-cargo").value.trim(),
        tiempo_laborado: card.querySelector(".exp-tiempo").value.trim(),
        salario: card.querySelector(".exp-salario").value.trim(),
        motivo_retiro: card.querySelector(".exp-motivo").value.trim(),
        causa_motivo_retiro: card.querySelector(".exp-causa").value.trim(),
        funciones: card.querySelector(".exp-funciones").value.trim(),
        observaciones: card.querySelector(".exp-observaciones").value.trim()
      }));

      return expData;
    }

    // =====================
    // FAMILIARES DIN√ÅMICOS
    // =====================
    const famList = document.getElementById("fam-list");
    const btnAddFam = document.getElementById("btn-add-fam");

    let familiaresData = [];

    function crearCardFamiliar(index, data = {}) {
      return `
        <div class="fam-card" data-index="${index}">
          <div class="fam-grid">
            <div class="field">
              <label>Nombre completo</label>
              <input type="text" class="fam-nombre" value="${data.nombre_completo || ""}">
            </div>
            <div class="field">
              <label>Parentesco</label>
              <input type="text" class="fam-parentesco" value="${data.parentesco || ""}">
            </div>
            <div class="field">
              <label>Edad</label>
              <input type="number" class="fam-edad" value="${data.edad || ""}">
            </div>
            <div class="field">
              <label>Ocupaci√≥n</label>
              <input type="text" class="fam-ocupacion" value="${data.ocupacion || ""}">
            </div>
            <div class="field">
              <label>¬øConviven juntos?</label>
              <select class="fam-conviven">
                <option value="1" ${data.conviven_juntos == 1 ? "selected" : ""}>S√≠</option>
                <option value="0" ${data.conviven_juntos == 0 ? "selected" : ""}>No</option>
              </select>
            </div>
          </div>
          <span class="fam-remove" onclick="eliminarFamiliar(${index})">üóëÔ∏è Eliminar</span>
        </div>
      `;
    }

    function renderFamiliares() {
      famList.innerHTML = "";
      familiaresData.forEach((item, index) => {
        famList.innerHTML += crearCardFamiliar(index, item);
      });
    }
    
      // Inicializar primer registro por defecto para Educaci√≥n, Experiencia y Familiares
  // (Pegar justo despu√©s de `function renderFamiliares() { ... }` y antes del resto del c√≥digo)
  if (Array.isArray(educacionData) && educacionData.length === 0) {
    educacionData.push({
      institucion: "",
      programa: "",
      modalidad: "",
      ano: "",
      finalizado: "1"
    });
    renderEducacion();
  }

  if (Array.isArray(expData) && expData.length === 0) {
    expData.push({
      empresa: "",
      cargo: "",
      tiempo_laborado: "",
      salario: "",
      motivo_retiro: "",
      causa_motivo_retiro: "",
      funciones: "",
      observaciones: ""
    });
    renderExp();
  }

  if (Array.isArray(familiaresData) && familiaresData.length === 0) {
    familiaresData.push({
      nombre_completo: "",
      parentesco: "",
      edad: "",
      ocupacion: "",
      conviven_juntos: "1"
    });
    renderFamiliares();
  }
    
    btnAddFam.addEventListener("click", () => {
      recopilarFamiliares();
      familiaresData.push({
        nombre_completo: "",
        parentesco: "",
        edad: "",
        ocupacion: "",
        conviven_juntos: "1"
      });
      renderFamiliares();
    });

    function eliminarFamiliar(index) {
      familiaresData.splice(index, 1);
      renderFamiliares();
    }
    window.eliminarFamiliar = eliminarFamiliar;

    function recopilarFamiliares() {
      const cards = document.querySelectorAll(".fam-card");

      familiaresData = Array.from(cards).map(card => ({
        nombre_completo: card.querySelector(".fam-nombre").value.trim(),
        parentesco: card.querySelector(".fam-parentesco").value.trim(),
        edad: card.querySelector(".fam-edad").value.trim(),
        ocupacion: card.querySelector(".fam-ocupacion").value.trim(),
        conviven_juntos: card.querySelector(".fam-conviven").value.trim()
      }));

      return familiaresData;
    }

    // ========= Toggles de seguridad =========
    function handleToggle(selectId, wrapperId) {
      const select = document.getElementById(selectId);
      const wrapper = document.getElementById(wrapperId);

      if (!select || !wrapper) return;

      select.addEventListener("change", () => {
        if (select.value === "1") {
          wrapper.classList.remove("hidden");
        } else {
          wrapper.classList.add("hidden");
          const inputs = wrapper.querySelectorAll("input, textarea");
          inputs.forEach(i => i.value = "");
        }
      });
    }

    handleToggle("seg_llamados", "detalle_llamados_wrap");
    handleToggle("seg_accidente", "detalle_accidente_wrap");
    handleToggle("seg_enfermedad", "detalle_enfermedad_wrap");
    handleToggle("seg_alcohol", "detalle_alcohol_wrap");
    handleToggle("seg_familiar", "detalle_familiar_wrap");

    // ======== Funci√≥n para PRELLENAR datos ========
    // Reemplazar la funci√≥n rellenarFormulario existente por esta:
    // Reemplaza la funci√≥n existente por esta versi√≥n m√°s robusta y con logs:
function rellenarFormulario(a) {
  try {
    console.log("rellenarFormulario - payload:", a);

    if (!a) return;

    // aspirante puede estar en a.aspirante (forma que devuelve el backend) o directamente en 'a'
    const aspirante = a.aspirante || a;

    const set = (id, value) => {
      const el = document.getElementById(id);
      if (el) {
        el.value = value != null ? value : "";
      }
    };

    // --- Campos personales (usar la fila aspirante si existe) ---
    if (aspirante) {
      set("primer_nombre", aspirante.primer_nombre || "");
      set("segundo_nombre", aspirante.segundo_nombre || "");
      set("primer_apellido", aspirante.primer_apellido || "");
      set("segundo_apellido", aspirante.segundo_apellido || "");
      set("correo_electronico", aspirante.correo_electronico || "");
      set("telefono", aspirante.telefono || "");
      set("direccion_barrio", aspirante.direccion_barrio || "");
      set("estado_civil", aspirante.estado_civil || "");
      set("eps", aspirante.eps || "");
      set("afp", aspirante.afp || "");
      set("rh", aspirante.rh || "");
      set("talla_pantalon", aspirante.talla_pantalon || "");
      set("camisa_talla", aspirante.camisa_talla || "");
      set("zapatos_talla", aspirante.zapatos_talla || "");
      set("fecha_nacimiento", aspirante.fecha_nacimiento || "");
      set("fecha_expedicion", aspirante.fecha_expedicion || "");
      set("departamento_expedicion", aspirante.departamento_expedicion || "");
      set("ciudad_expedicion", aspirante.ciudad_expedicion || "");
      // En la BD la columna de residencia se llama 'departamento' / 'ciudad' en la tabla aspirante
      set("departamento_residencia", aspirante.departamento || "");
      set("ciudad_residencia", aspirante.ciudad || "");
      // Tipo de documento e identificaci√≥n s√≥lo si est√°n vac√≠os (se manejan por sessionStorage/prellenado)
      const identEl = document.getElementById("identificacion");
      if (identEl && !identEl.value && aspirante.identificacion) identEl.value = aspirante.identificacion;
      const tipoEl = document.getElementById("tipo_documento");
      if (tipoEl && !tipoEl.value && aspirante.tipo_documento) tipoEl.value = aspirante.tipo_documento;
    }

    // --- Relacionales (arrays) ---
    const educ = Array.isArray(a.educacion) ? a.educacion : (Array.isArray(a.educacion) ? a.educacion : (a.educacion || []));
    const exp = Array.isArray(a.experiencia_laboral) ? a.experiencia_laboral : (a.experiencia_laboral || []);
    const fam = Array.isArray(a.familiares) ? a.familiares : (a.familiares || []);

    // Educaci√≥n
    if (educ && educ.length > 0) {
      educacionData = educ.map(e => ({
        institucion: e.institucion || "",
        programa: e.programa || "",
        modalidad: e.modalidad || "",
        ano: e.ano || "",
        finalizado: (typeof e.finalizado !== "undefined" && e.finalizado !== null) ? String(e.finalizado) : "1"
      }));
    } else {
      // mantener al menos una card vac√≠a para UX
      educacionData = educacionData && educacionData.length > 0 ? educacionData : [{
        institucion: "",
        programa: "",
        modalidad: "",
        ano: "",
        finalizado: "1"
      }];
    }
    renderEducacion();

    // Experiencia
    if (exp && exp.length > 0) {
      expData = exp.map(x => ({
        empresa: x.empresa || "",
        cargo: x.cargo || "",
        tiempo_laborado: x.tiempo_laborado || "",
        salario: x.salario || "",
        motivo_retiro: x.motivo_retiro || "",
        causa_motivo_retiro: x.causa_motivo_retiro || "",
        funciones: x.funciones || "",
        observaciones: x.observaciones || ""
      }));
    } else {
      expData = expData && expData.length > 0 ? expData : [{
        empresa: "",
        cargo: "",
        tiempo_laborado: "",
        salario: "",
        motivo_retiro: "",
        causa_motivo_retiro: "",
        funciones: "",
        observaciones: ""
      }];
    }
    renderExp();

    // Familiares
    if (fam && fam.length > 0) {
      familiaresData = fam.map(f => ({
        nombre_completo: f.nombre_completo || "",
        parentesco: f.parentesco || "",
        edad: f.edad || "",
        ocupacion: f.ocupacion || "",
        conviven_juntos: (typeof f.conviven_juntos !== "undefined" && f.conviven_juntos !== null) ? String(f.conviven_juntos) : "1"
      }));
    } else {
      familiaresData = familiaresData && familiaresData.length > 0 ? familiaresData : [{
        nombre_completo: "",
        parentesco: "",
        edad: "",
        ocupacion: "",
        conviven_juntos: "1"
      }];
    }
    renderFamiliares();

    // Referencias
    const refs = Array.isArray(a.referencias) ? a.referencias : (a.referencias || []);
    if (refs && refs.length > 0) {
      refs.forEach(r => {
        const tipo = (r.tipo_referencia || "").toLowerCase();
        if (tipo === "laboral" || tipo === "laboral") {
          set("ref_lab_empresa", r.empresa || "");
          set("ref_lab_jefe", r.jefe_inmediato || "");
          set("ref_lab_cargo", r.cargo_jefe || "");
          set("ref_lab_tel", r.telefono || "");
        } else if (tipo === "familiar") {
          set("ref_fam_nombre", r.nombre_completo || "");
          set("ref_fam_parentesco", r.parentesco || r.relacion || "");
          set("ref_fam_tel", r.telefono || "");
          set("ref_fam_ocupacion", r.ocupacion || "");
        } else if (tipo === "personal") {
          set("ref_per_nombre", r.nombre_completo || "");
          set("ref_per_relacion", r.relacion || "");
          set("ref_per_tel", r.telefono || "");
          set("ref_per_ocupacion", r.ocupacion || "");
        }
      });
    }

    // Contacto de emergencia
    if (a.contacto_emergencia) {
      set("emer_nombre", a.contacto_emergencia.nombre_completo || "");
      set("emer_parentesco", a.contacto_emergencia.parentesco || "");
      set("emer_telefono", a.contacto_emergencia.telefono || "");
      set("emer_correo", a.contacto_emergencia.correo_electronico || "");
      set("emer_direccion", a.contacto_emergencia.direccion || "");
    }

    // Metas personales
    if (a.metas_personales) {
      set("meta_corto", a.metas_personales.meta_corto_plazo || "");
      set("meta_mediano", a.metas_personales.meta_mediano_plazo || "");
      set("meta_largo", a.metas_personales.meta_largo_plazo || "");
    }

    // Seguridad / cuestionario
    if (a.seguridad) {
      const s = a.seguridad;
      if (typeof s.llamados_atencion !== "undefined") {
        document.getElementById("seg_llamados").value = String(s.llamados_atencion || 0);
        if (s.llamados_atencion == 1) document.getElementById("detalle_llamados_wrap").classList.remove("hidden");
        set("seg_detalle_llamados", s.detalle_llamados || "");
      }
      if (typeof s.accidente_laboral !== "undefined") {
        document.getElementById("seg_accidente").value = String(s.accidente_laboral || 0);
        if (s.accidente_laboral == 1) document.getElementById("detalle_accidente_wrap").classList.remove("hidden");
        set("seg_detalle_accidente", s.detalle_accidente || "");
      }
      if (typeof s.enfermedad_importante !== "undefined") {
        document.getElementById("seg_enfermedad").value = String(s.enfermedad_importante || 0);
        if (s.enfermedad_importante == 1) document.getElementById("detalle_enfermedad_wrap").classList.remove("hidden");
        set("seg_detalle_enfermedad", s.detalle_enfermedad || "");
      }
      if (typeof s.consume_alcohol !== "undefined") {
        document.getElementById("seg_alcohol").value = String(s.consume_alcohol || 0);
        if (s.consume_alcohol == 1) document.getElementById("detalle_alcohol_wrap").classList.remove("hidden");
        set("seg_frecuencia", s.frecuencia_alcohol || "");
      }
      if (typeof s.familiar_en_empresa !== "undefined") {
        document.getElementById("seg_familiar").value = String(s.familiar_en_empresa || 0);
        if (s.familiar_en_empresa == 1) document.getElementById("detalle_familiar_wrap").classList.remove("hidden");
        set("seg_familiar_nombre", s.detalle_familiar_empresa || "");
      }
      set("seg_observaciones", s.observaciones || "");
      set("seg_califica", s.califica_para_cargo || "");
      set("seg_fortal", s.fortalezas || "");
      set("seg_mejorar", s.aspectos_mejorar || "");
      set("seg_resolucion", s.resolucion_problemas || "");
      if (typeof s.info_falsa !== "undefined") document.getElementById("seg_falsa").value = String(s.info_falsa || 0);
      if (typeof s.acepta_poligrafo !== "undefined") document.getElementById("seg_poligrafo").value = String(s.acepta_poligrafo || 0);
    }

    console.log("rellenarFormulario - finished. educacionData, expData, familiaresData lengths:", educacionData.length, expData.length, familiaresData.length);
  } catch (err) {
    console.error("Error en rellenarFormulario:", err);
  }
}
    // Medio de reclutamiento ‚Üí mostrar campo recomendador
    medioSelect.addEventListener("change", () => {
      const value = medioSelect.value;
      const needsRecomendador =
        value === "recomendado" || value === "empleado_interno";
      if (needsRecomendador) {
        campoRecomendador.classList.remove("hidden");
      } else {
        campoRecomendador.classList.add("hidden");
      }
    });

    // Edad autom√°tica
    fechaNacimientoInput.addEventListener("change", () => {
      const value = fechaNacimientoInput.value;
      if (!value) {
        edadInput.value = "";
        return;
      }
      const birthDate = new Date(value);
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const m = today.getMonth() - birthDate.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      edadInput.value = age >= 0 ? age : "";
    });

    // Navegaci√≥n
    // Registrar el listener del bot√≥n "Anterior" UNA VEZ (correcci√≥n)
    btnPrev.addEventListener("click", () => {
      if (currentStep > 0) {
        showStep(currentStep - 1);
      }
    });

    btnNext.addEventListener("click", async () => {
      if (currentStep === 0) {

        const ok = await validarIngreso();
        if (!ok) return;

        // Guardar valores solo cuando VALID√ì y va a pasar al paso 1
        sessionStorage.setItem("tipo_ingreso", tipoDocumentoIngreso.value.trim());
        sessionStorage.setItem("id_ingreso", identificacionIngreso.value.trim());
      }

      if (!validateStep(currentStep)) return;

      if (currentStep < steps.length - 1) {
        showStep(currentStep + 1);
      }
    });


    // Construcci√≥n de PREVIEW (Opci√≥n C)
    function buildPreview() {
      const wrap = document.getElementById("preview-container");
      if (!wrap) return;

      // Actualizar arrays din√°micos antes de leer
      recopilarEducacion();
      recopilarExp();
      recopilarFamiliares();

      const v = (id) => {
        const el = document.getElementById(id);
        return el ? (el.value || "").trim() : "";
      };

      const datosPersonalesResumen =
        [v("primer_nombre"), v("segundo_nombre"), v("primer_apellido"), v("segundo_apellido")]
          .filter(Boolean)
          .join(" ");

      const ciudadResidencia = [v("ciudad_residencia"), v("departamento_residencia")]
        .filter(Boolean)
        .join(" - ");

      const medioRec = v("medio_reclutamiento");

      const educCount = educacionData.length;
      const expCount = expData.length;
      const famCount = familiaresData.length;

      // Secciones
      const bloqueDatos = `
        <div class="preview-section">
          <details open>
            <summary>
              Datos personales
              <span class="preview-pill">Obligatorio</span>
            </summary>
            <div class="preview-content">
              <div class="preview-row">
                <span class="preview-label">Nombre completo</span>
                <span class="preview-value">${datosPersonalesResumen || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Identificaci√≥n</span>
                <span class="preview-value">${v("identificacion") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Fecha nacimiento</span>
                <span class="preview-value">${v("fecha_nacimiento") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Edad</span>
                <span class="preview-value">${v("edad") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Ciudad de residencia</span>
                <span class="preview-value">${ciudadResidencia || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Tel√©fono</span>
                <span class="preview-value">${v("telefono") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Correo</span>
                <span class="preview-value">${v("correo_electronico") || "-"}</span>
              </div>
            </div>
          </details>
        </div>
      `;

      const bloqueReclutamiento = `
        <div class="preview-section">
          <details>
            <summary>
              Medio de reclutamiento
              <span class="preview-pill">Registro inicial</span>
            </summary>
            <div class="preview-content">
              <div class="preview-row">
                <span class="preview-label">Medio</span>
                <span class="preview-value">${medioRec || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Recomendador / contacto</span>
                <span class="preview-value">${v("recomendador_aspirante") || "-"}</span>
              </div>
            </div>
          </details>
        </div>
      `;

      const bloqueSalud = `
        <div class="preview-section">
          <details>
            <summary>
              Salud y dotaci√≥n
              <span class="preview-pill">Informaci√≥n general</span>
            </summary>
            <div class="preview-content">
              <div class="preview-row">
                <span class="preview-label">EPS</span>
                <span class="preview-value">${v("eps") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Pensi√≥n</span>
                <span class="preview-value">${v("afp") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">RH</span>
                <span class="preview-value">${v("rh") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Talla pantal√≥n</span>
                <span class="preview-value">${v("talla_pantalon") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Talla camisa</span>
                <span class="preview-value">${v("camisa_talla") || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Talla zapatos</span>
                <span class="preview-value">${v("zapatos_talla") || "-"}</span>
              </div>
            </div>
          </details>
        </div>
      `;

      const bloqueEducacion = `
        <div class="preview-section">
          <details>
            <summary>
              Educaci√≥n
              <span class="preview-pill">${educCount} registro(s)</span>
            </summary>
            <div class="preview-content">
              ${
                educCount === 0
                  ? "<p>No registraste estudios.</p>"
                  : educacionData.map((e, i) => `
                    <div style="margin-bottom:6px;">
                      <strong>${i + 1}. ${e.institucion || "Instituci√≥n no especificada"}</strong><br>
                      <span>${e.programa || "Programa no especificado"} (${e.modalidad || "-"})</span><br>
                      <span>A√±o: ${e.ano || "-"} | Finalizado: ${e.finalizado == 1 ? "S√≠" : "No"}</span>
                    </div>
                  `).join("")
              }
            </div>
          </details>
        </div>
      `;

      const bloqueExp = `
        <div class="preview-section">
          <details>
            <summary>
              Experiencia laboral
              <span class="preview-pill">${expCount} registro(s)</span>
            </summary>
            <div class="preview-content">
              ${
                expCount === 0
                  ? "<p>No registraste experiencia laboral.</p>"
                  : expData.map((e, i) => `
                    <div style="margin-bottom:6px;">
                      <strong>${i + 1}. ${e.empresa || "Empresa no especificada"}</strong><br>
                      <span>Cargo: ${e.cargo || "-"}</span><br>
                      <span>Tiempo: ${e.tiempo_laborado || "-"} | Salario: ${e.salario || "-"}</span><br>
                      <span>Motivo retiro: ${e.motivo_retiro || "-"}</span>
                    </div>
                  `).join("")
              }
            </div>
          </details>
        </div>
      `;

      const bloqueFamilia = `
        <div class="preview-section">
          <details>
            <summary>
              Familiares
              <span class="preview-pill">${famCount} registro(s)</span>
            </summary>
            <div class="preview-content">
              ${
                famCount === 0
                  ? "<p>No registraste familiares.</p>"
                  : familiaresData.map((f, i) => `
                    <div style="margin-bottom:6px;">
                      <strong>${i + 1}. ${f.nombre_completo || "Sin nombre"}</strong><br>
                      <span>Parentesco: ${f.parentesco || "-"}</span><br>
                      <span>Edad: ${f.edad || "-"}</span><br>
                      <span>Ocupaci√≥n: ${f.ocupacion || "-"}</span><br>
                      <span>Conviven juntos: ${f.conviven_juntos == 1 ? "S√≠" : "No"}</span>
                    </div>
                  `).join("")
              }
            </div>
          </details>
        </div>
      `;

      const bloqueReferencias = `
        <div class="preview-section">
          <details>
            <summary>
              Referencias
              <span class="preview-pill">3 tipos</span>
            </summary>
            <div class="preview-content">
              <strong>Laboral</strong><br>
              Empresa: ${ref_lab_empresa.value.trim() || "-"}<br>
              Jefe: ${ref_lab_jefe.value.trim() || "-"}<br>
              Tel√©fono: ${ref_lab_tel.value.trim() || "-"}<br><br>

              <strong>Familiar</strong><br>
              Nombre: ${ref_fam_nombre.value.trim() || "-"}<br>
              Parentesco: ${ref_fam_parentesco.value.trim() || "-"}<br>
              Tel√©fono: ${ref_fam_tel.value.trim() || "-"}<br><br>

              <strong>Personal</strong><br>
              Nombre: ${ref_per_nombre.value.trim() || "-"}<br>
              Relaci√≥n: ${ref_per_relacion.value.trim() || "-"}<br>
              Tel√©fono: ${ref_per_tel.value.trim() || "-"}
            </div>
          </details>
        </div>
      `;

      const bloqueEmergencia = `
        <div class="preview-section">
          <details>
            <summary>
              Contacto de emergencia
              <span class="preview-pill">1 contacto</span>
            </summary>
            <div class="preview-content">
              <div class="preview-row">
                <span class="preview-label">Nombre</span>
                <span class="preview-value">${emer_nombre.value.trim() || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Parentesco</span>
                <span class="preview-value">${emer_parentesco.value.trim() || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Tel√©fono</span>
                <span class="preview-value">${emer_telefono.value.trim() || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Correo</span>
                <span class="preview-value">${emer_correo.value.trim() || "-"}</span>
              </div>
            </div>
          </details>
        </div>
      `;

      const bloqueMetas = `
        <div class="preview-section">
          <details>
            <summary>
              Metas personales
              <span class="preview-pill">Resumen</span>
            </summary>
            <div class="preview-content">
              <div class="preview-row">
                <span class="preview-label">Corto plazo</span>
                <span class="preview-value">${meta_corto.value.trim() || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Mediano plazo</span>
                <span class="preview-value">${meta_mediano.value.trim() || "-"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Largo plazo</span>
                <span class="preview-value">${meta_largo.value.trim() || "-"}</span>
              </div>
            </div>
          </details>
        </div>
      `;

      const bloqueSeguridad = `
        <div class="preview-section">
          <details>
            <summary>
              Cuestionario personal
              <span class="preview-pill">Confidencial</span>
            </summary>
            <div class="preview-content">
              <div class="preview-row">
                <span class="preview-label">Llamados de atenci√≥n</span>
                <span class="preview-value">${seg_llamados.value === "1" ? "S√≠" : "No"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Accidente laboral</span>
                <span class="preview-value">${seg_accidente.value === "1" ? "S√≠" : "No"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Enfermedad importante</span>
                <span class="preview-value">${seg_enfermedad.value === "1" ? "S√≠" : "No"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Consume alcohol</span>
                <span class="preview-value">${seg_alcohol.value === "1" ? "S√≠" : "No"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Familiar en empresa</span>
                <span class="preview-value">${seg_familiar.value === "1" ? "S√≠" : "No"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Acepta pol√≠grafo</span>
                <span class="preview-value">${seg_poligrafo.value === "1" ? "S√≠" : "No"}</span>
              </div>
              <div class="preview-row">
                <span class="preview-label">Motivaci√≥n para el cargo</span>
                <span class="preview-value">${seg_califica.value.trim() || "-"}</span>
              </div>
            </div>
          </details>
        </div>
      `;

      wrap.innerHTML =
        bloqueDatos +
        bloqueReclutamiento +
        bloqueSalud +
        bloqueEducacion +
        bloqueExp +
        bloqueFamilia +
        bloqueReferencias +
        bloqueEmergencia +
        bloqueMetas +
        bloqueSeguridad;
    }

    // Submit final
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = {};

      formData.forEach((value, key) => {
        data[key] = value;
      });

      data.educacion = recopilarEducacion();
      data.experiencia_laboral = recopilarExp();
      data.familiares = recopilarFamiliares();

      data.referencias = [
        {
          tipo_referencia: "laboral",
          empresa: ref_lab_empresa.value.trim(),
          jefe_inmediato: ref_lab_jefe.value.trim(),
          cargo_jefe: ref_lab_cargo.value.trim(),
          telefono: ref_lab_tel.value.trim(),
        },
        {
          tipo_referencia: "familiar",
          nombre_completo: ref_fam_nombre.value.trim(),
          parentesco: ref_fam_parentesco.value.trim(),
          telefono: ref_fam_tel.value.trim(),
          ocupacion: ref_fam_ocupacion.value.trim(),
        },
        {
          tipo_referencia: "personal",
          nombre_completo: ref_per_nombre.value.trim(),
          relacion: ref_per_relacion.value.trim(),
          telefono: ref_per_tel.value.trim(),
          ocupacion: ref_per_ocupacion.value.trim(),
        }
      ];

      data.contacto_emergencia = {
        nombre_completo: emer_nombre.value.trim(),
        parentesco: emer_parentesco.value.trim(),
        telefono: emer_telefono.value.trim(),
        correo_electronico: emer_correo.value.trim(),
        direccion: emer_direccion.value.trim()
      };

      data.metas_personales = {
        corto_plazo: meta_corto.value.trim(),
        mediano_plazo: meta_mediano.value.trim(),
        largo_plazo: meta_largo.value.trim(),
      };

      data.seguridad = {
        llamados_atencion: seg_llamados.value,
        accidente_laboral: seg_accidente.value,
        enfermedad_importante: seg_enfermedad.value,
        consume_alcohol: seg_alcohol.value,
        frecuencia_alcohol: seg_frecuencia.value.trim(),
        familiar_en_empresa: seg_familiar.value,
        detalle_familiar_empresa: seg_familiar_nombre.value.trim(),
        info_falsa: seg_falsa.value,
        acepta_poligrafo: seg_poligrafo.value,
        observaciones: seg_observaciones.value.trim(),
        califica_para_cargo: seg_califica.value.trim(),
        fortalezas: seg_fortal.value.trim(),
        aspectos_mejorar: seg_mejorar.value.trim(),
        resolucion_problemas: seg_resolucion.value.trim(),
      };

      try {
        const resp = await fetch("/api/hv/registrar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await resp.json();

        if (resp.ok && result.ok) {
          alert("‚úî Hoja de vida registrada correctamente.\nID: " + result.id_aspirante);
        } else {
          alert("‚ö† Ocurri√≥ un error guardando la hoja de vida.");
        }
      } catch (err) {
        console.error(err);
        alert("‚ö† Error de conexi√≥n con el servidor.");
      }
    });

        // ‚≠ê FUNCI√ìN PARA PRELLENAR DATOS PERSONALES ‚≠ê
    // ‚≠ê FUNCI√ìN PARA PRELLENAR DATOS PERSONALES ‚≠ê
function prellenarDatosPersonales() {
  // Lo que se guard√≥ en el paso 0
  const tipo = sessionStorage.getItem("tipo_ingreso");   // ya es la DESCRIPCI√ìN
  const id   = sessionStorage.getItem("id_ingreso");
  const form = document.getElementById("hv-form");

  // Helper para crear/actualizar hidden inputs
  function ensureHidden(name, idEl, value) {
    let hid = document.getElementById(idEl);
    if (!hid) {
      hid = document.createElement("input");
      hid.type = "hidden";
      hid.id = idEl;
      hid.name = name;
      form.appendChild(hid);
    }
    hid.value = value || "";
  }

  // === Tipo de documento (Paso 2) ===
  if (tipo) {
    const selectTipo = document.getElementById("tipo_documento");
    if (selectTipo) {
      selectTipo.value = tipo;              // coincide con las opciones que carga app.js
      // Para que el usuario no lo cambie, lo dejamos disabled (select no soporta readonly).
      // Pero a√±adimos un hidden con el mismo name para que se env√≠e en el submit.
      selectTipo.setAttribute("disabled", true);
      ensureHidden("tipo_documento", "hidden_tipo_documento", tipo);
    }
  }

  // === N√∫mero de identificaci√≥n (Paso 2) ===
  if (id) {
    const inputId = document.getElementById("identificacion");
    if (inputId) {
      inputId.value = id;
      // Para inputs podemos usar readonly (se incluye en el submit). Si por UX prefieres disabled,
      // el hidden garantiza que el backend reciba el valor.
      inputId.setAttribute("readonly", true);
      ensureHidden("identificacion", "hidden_identificacion", id);
    }
  }
}
  </script>

  <!-- Selects din√°micos (tipo doc, dptos, ciudades, EPS, AFP) -->
<script src="app.js"></script>

<script>
  // ‚≠ê Cargar tipos de identificaci√≥n din√°micos para el Paso 0 ‚≠ê
async function cargarTiposPaso0() {
  try {
    const res = await fetch("/api/config/tipo-identificacion");
    const tipos = await res.json();

    const select = document.getElementById("tipo_documento_ingreso");
    select.innerHTML = `<option value="">Selecciona...</option>`;

    tipos.forEach(t => {
      select.innerHTML += `
        <option value="${t.descripcion}">${t.descripcion}</option>
      `;
    });

  } catch (err) {
    console.error("Error cargando tipos de identificaci√≥n para Paso 0:", err);
  }
}
  // Cuando el DOM est√© listo cargamos ambos pasos
  document.addEventListener("DOMContentLoaded", () => {

    // 1) Cargar selects del paso 2 (desde app.js)
    inicializarSelects();

    // 2) Cargar selects del paso 0 (din√°mico desde MySQL)
    cargarTiposPaso0();

    // 3) Despu√©s de que ambos selects est√©n cargados, prellenar tipo + identificaci√≥n
    document.addEventListener("tipos-cargados", prellenarDatosPersonales);

  });
</script>
</body>
</html>